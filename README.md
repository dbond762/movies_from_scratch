# movies_from_scratch

## Описание приложения

Веб-приложение для хранения информации о фильмах.

Информация о фильме:
1. Уникальный идентификатор
2. Название
3. Год выпуска
4. Формат (VHS, DVD, Blu-Ray)
5. Список актеров ("Имя и фамилия актера")

Функции, которые поддерживает система:
1. Добавить фильм
2. Удалить фильм
3. Показать информацию о фильме
4. Показать список фильмов, отсортированных по названию в алфавитном порядке
5. Найти фильм по названию.
6. Найти фильм по имени актера.
7. Импорт фильмов с текстового файла. Файл загружается через веб-интерфейс.

Задание реализовано на PHP без использования фреймворков.
Данные храниться в базе данных MySQL.

## Как запустить

```bash
git clone https://github.com/dbond762/movies_from_scratch.git
cd movies_from_scratch
composer install
```

Создать базу данных MySQL.
В db.sql находится код для создания таблиц и тестовые данные.

В App/config.php необходимо указать параметры подключения к базе.
За основу можно взять App/config_example.php

```php
<?php

$config['host']    = '127.0.0.1';  // host
$config['db']      = 'dbname';     // database name
$config['user']    = 'root';       // user
$config['pass']    = '';           // password
$config['charset'] = 'utf8';       // character set
```

Запускаем сервер

## Описание архитектуры приложения

В папке `Lib` находятся файлы фреймворка. В `App` - код приложения.

`Lib\Router\Router` - Роутер. При настройке указывается http метод, эндпоинт и колбек функция, которая при этом должна выполнится.
Роутер позволяет выполнять группировку путей и задавать middleware
(глобално, для группы или для конкретного роута. Сами middleware пока не применяются, но задать их можно).
Роутер перебирает пути по мере их указания и производит матчинг с первым совпадением,
поэтому необходимо сразу указывать более специфичные роуты, потом более общие.

Паттерн задается в виде строки вида `"/same/path/with/{param:int}"`.
Паттерн должен начинатся со слеша и может содержать параметры разных типов.
Параметр заключается в `{ }` фигурные скобочки, может содержать спецификацию типа.
По умолчанию доступны `:string` и `:int`, но есть возможность добавить другие типы при конфигурации.

Колбек функция - это `Closure`, которая получает на вход один параметр - контекст.
Контекст представляет из себя ассоциативный массив, который может содержать какую либо информацию, задаваемую middleware.
Также в нем можно получить параметры из url запроса по ключу `'params'`.
Ключи, начинающиеся с `_` используются роутером.

Также в роутере имеется хелпер для болле удобного задания колбека из контроллера.

Пример настройки роутера:
```php
<?php

use App\Controllers\Movies;
use Lib\Router\Router;

$r = new Router();

$r->having($some_middleware)

$r->get('/hello', function($ctx) {
    echo 'hello page';
});

$r->route('/articles', function($r) {
    $r->with($some_middleware)->post('/add', function($ctx) {
        echo "it's /articles/add";
    });
    
    $r->get('/{article_id:int}', function($ctx) {
        $article_id = $ctx['params']['article_id'];
        echo "get /articles/{$article_id}";
    });
    
    // Controller helper to make it easy to set up a callback from a controller
    $r->post('/{article_id:int}', Router::controller(Movies::class, 'update'));
});

$r->mount('/admin', admin_router());  // admin_router should return Router object

$r->serve();
```


В Lib также находятся `Config`, `Model`, `Respose` и `StringHelper` (используется в роутере).

В `Lib\Response\Response` находятся методы `view` и `redirect`.

`Response::view('article/detail', $data);` - выводит `App/Views/article/detail.php` , в котором будут доступны переменные из `$data`.

В `Lib/Response/template_funcs.php` находятся функции, доступные во views - `view` и `is_page`.

`<?php view('article/filter', $data); ?>` - выводит в указанном месте темплейт с указанными данными.
Если в темплейте нужен доступ к переменным текущего темплейта, то нужно передать `$data`.

`is_page($path, $echo = '')` - возвращает true, если текущая страница - `$path`. Если задать `$echo` - выведет указанный строку.


`App/Routs.php` - задает роуты приложения.
Должен содержать функцию `get_router(Lib\Router\Router $r)` - Внутри которой происходит настройка роутера.

`App/config.php` - конфиг.

`App/Controllers` - содержит контролеры. Может содержать в конструкторе задание необходимых контролеру моделей.

`App/Models` - содержит модели.
Класс модели должен наследоваться от `Lib\Model\Model`
В `$this->pdo` находится стандартный PDO объект для выполнения запросов.

`App/Views` - шаблоны страниц (php).
